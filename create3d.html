<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameForge - 3D ê²Œì„ ë§Œë“¤ê¸°</title>
    <link rel="stylesheet" href="/style/style.css">
    <style>
        #editor-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        #tools {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        #gameCanvas {
            border: 2px solid #333;
            background-color: #000;
        }
        
        .tool-group {
            border-top: 1px solid #ccc;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        button {
            padding: 8px 12px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .property-panel {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            display: none;
        }
        
        .property-panel h3 {
            margin-top: 0;
        }
        
        .property-group {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
        }
        
        input[type="range"],
        input[type="color"],
        select {
            width: 100%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>ë‚´ ê²Œì„ í”Œë«í¼</h1>
        <nav>
            <ul>
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="games.html">ê²Œì„ ëª©ë¡</a></li>
                <li><a href="create.html">2D ê²Œì„ ë§Œë“¤ê¸°</a></li>
                <li><a href="create3d.html">3D ê²Œì„ ë§Œë“¤ê¸°</a></li>
                <li><a href="login.html">ë¡œê·¸ì¸</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2>3D ê²Œì„ ë§Œë“¤ê¸°</h2>
        <div id="editor-container">
            <div id="tools">
                <h3>ê¸°ë³¸ ë„êµ¬</h3>
                <button onclick="selectTool('select')">ğŸ–±ï¸ ì„ íƒ</button>
                <button onclick="selectTool('move')">â†”ï¸ ì´ë™</button>
                <button onclick="selectTool('rotate')">ğŸ”„ íšŒì „</button>
                <button onclick="selectTool('scale')">ğŸ“ í¬ê¸° ì¡°ì ˆ</button>
                
                <div class="tool-group">
                    <h3>ì˜¤ë¸Œì íŠ¸ ì¶”ê°€</h3>
                    <button onclick="addObject('cube')">ğŸ§Š íë¸Œ</button>
                    <button onclick="addObject('sphere')">âš½ êµ¬ì²´</button>
                    <button onclick="addObject('cylinder')">ğŸ›¢ï¸ ì›í†µ</button>
                    <button onclick="addObject('plane')">ğŸ“„ í‰ë©´</button>
                    <button onclick="addObject('player')">ğŸ® í”Œë ˆì´ì–´</button>
                    <button onclick="addObject('light')">ğŸ’¡ ì¡°ëª…</button>
                </div>
                
                <div class="tool-group">
                    <h3>í™˜ê²½ ì„¤ì •</h3>
                    <button onclick="toggleSkybox()">ğŸŒˆ í•˜ëŠ˜ ë°°ê²½</button>
                    <button onclick="togglePhysics()">ğŸ§² ë¬¼ë¦¬ ì—”ì§„</button>
                    <button onclick="toggleCollision()">ğŸ’¥ ì¶©ëŒ ê°ì§€</button>
                </div>
                
                <div class="tool-group">
                    <h3>ê²Œì„ ê´€ë¦¬</h3>
                    <button onclick="previewGame()">â–¶ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
                    <button onclick="clearScene()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                    <button onclick="saveGame()">ğŸ’¾ ì €ì¥</button>
                </div>
            </div>
            
            <div id="canvas-container">
                <canvas id="gameCanvas" width="600" height="400"></canvas>
            </div>
        </div>
        
        <div id="property-panel" class="property-panel">
            <h3>ì†ì„± í¸ì§‘</h3>
            <div id="general-properties" class="property-group">
                <label for="objectName">ì´ë¦„:</label>
                <input type="text" id="objectName">
                
                <div>
                    <label>ìœ„ì¹˜:</label>
                    X: <input type="range" id="posX" min="-10" max="10" step="0.1">
                    Y: <input type="range" id="posY" min="-10" max="10" step="0.1">
                    Z: <input type="range" id="posZ" min="-10" max="10" step="0.1">
                </div>
                
                <div>
                    <label>íšŒì „:</label>
                    X: <input type="range" id="rotX" min="0" max="360" step="1">
                    Y: <input type="range" id="rotY" min="0" max="360" step="1">
                    Z: <input type="range" id="rotZ" min="0" max="360" step="1">
                </div>
                
                <div>
                    <label>í¬ê¸°:</label>
                    X: <input type="range" id="scaleX" min="0.1" max="5" step="0.1" value="1">
                    Y: <input type="range" id="scaleY" min="0.1" max="5" step="0.1" value="1">
                    Z: <input type="range" id="scaleZ" min="0.1" max="5" step="0.1" value="1">
                </div>
                
                <div>
                    <label for="objectColor">ìƒ‰ìƒ:</label>
                    <input type="color" id="objectColor" value="#3080ff">
                </div>
            </div>
            
            <div id="physics-properties" class="property-group">
                <label for="massValue">ì§ˆëŸ‰:</label>
                <input type="range" id="massValue" min="0" max="100" step="1" value="1">
                
                <label for="frictionValue">ë§ˆì°°ë ¥:</label>
                <input type="range" id="frictionValue" min="0" max="1" step="0.01" value="0.5">
                
                <label for="bounciness">íƒ„ì„±:</label>
                <input type="range" id="bounciness" min="0" max="1" step="0.01" value="0.3">
            </div>
            
            <div id="behavior-properties" class="property-group">
                <label for="behaviorType">í–‰ë™ íŒ¨í„´:</label>
                <select id="behaviorType">
                    <option value="none">ì—†ìŒ</option>
                    <option value="rotate">íšŒì „</option>
                    <option value="oscillate">ì§„ë™</option>
                    <option value="follow">ë”°ë¼ê°€ê¸°</option>
                    <option value="patrol">ìˆœì°°</option>
                </select>
            </div>
        </div>
    </main>

    <footer>
        <p>Â© 2025 ë‚´ ê²Œì„ í”Œë«í¼</p>
    </footer>

    <script type="module">
        import * as THREE from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.js';
        import { OrbitControls } from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/jsm/controls/OrbitControls.js';
        import { TransformControls } from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/jsm/controls/TransformControls.js';

        // ì „ì—­ ë³€ìˆ˜
        let scene, camera, renderer, orbitControls, transformControls;
        let selectedTool = 'select';
        let selectedObject = null;
        let gameObjects = [];
        let skyboxEnabled = false;
        let physicsEnabled = false;
        let collisionEnabled = false;
        
        // ì”¬ ì´ˆê¸°í™”
        function initScene() {
            const canvas = document.getElementById('gameCanvas');
            
            // ì”¬ ìƒì„±
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);
            
            // ì¹´ë©”ë¼ ì„¤ì •
            camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // ë Œë”ëŸ¬ ì„¤ì •
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            
            // ì¡°ëª… ì¶”ê°€
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // ê·¸ë¦¬ë“œ í—¬í¼ ì¶”ê°€
            const gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);
            
            // ì¢Œí‘œì¶• í—¬í¼ ì¶”ê°€
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);
            
            // ì»¨íŠ¸ë¡¤ ì„¤ì •
            orbitControls = new OrbitControls(camera, renderer.domElement);
            
            transformControls = new TransformControls(camera, renderer.domElement);
            transformControls.addEventListener('dragging-changed', function(event) {
                orbitControls.enabled = !event.value;
            });
            scene.add(transformControls);
            
            // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
            animate();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            canvas.addEventListener('click', onCanvasClick);
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);
            
            // ì—¬ê¸°ì— ê²Œì„ ë¡œì§ ì¶”ê°€
            
            renderer.render(scene, camera);
        }
        
        // ë„êµ¬ ì„ íƒ
        window.selectTool = function(tool) {
            selectedTool = tool;
            
            if (transformControls && selectedObject) {
                if (tool === 'move') {
                    transformControls.setMode('translate');
                } else if (tool === 'rotate') {
                    transformControls.setMode('rotate');
                } else if (tool === 'scale') {
                    transformControls.setMode('scale');
                } else {
                    transformControls.detach();
                }
            }
        };
        
        // ì˜¤ë¸Œì íŠ¸ ì¶”ê°€
        window.addObject = function(type) {
            let geometry, material, object;
            
            switch (type) {
                case 'cube':
                    geometry = new THREE.BoxGeometry(1, 1, 1);
                    material = new THREE.MeshPhongMaterial({ color: 0x3080ff });
                    object = new THREE.Mesh(geometry, material);
                    object.userData.type = 'cube';
                    break;
                    
                case 'sphere':
                    geometry = new THREE.SphereGeometry(0.5, 32, 32);
                    material = new THREE.MeshPhongMaterial({ color: 0x3080ff });
                    object = new THREE.Mesh(geometry, material);
                    object.userData.type = 'sphere';
                    break;
                    
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
                    material = new THREE.MeshPhongMaterial({ color: 0x3080ff });
                    object = new THREE.Mesh(geometry, material);
                    object.userData.type = 'cylinder';
                    break;
                    
                case 'plane':
                    geometry = new THREE.PlaneGeometry(2, 2);
                    material = new THREE.MeshPhongMaterial({ 
                        color: 0x999999, 
                        side: THREE.DoubleSide 
                    });
                    object = new THREE.Mesh(geometry, material);
                    object.rotation.x = -Math.PI / 2;
                    object.userData.type = 'plane';
                    break;
                    
                case 'player':
                    // ê°„ë‹¨í•œ í”Œë ˆì´ì–´ ìºë¦­í„° (ì›í†µ + êµ¬)
                    const body = new THREE.CylinderGeometry(0.3, 0.3, 1, 16);
                    const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xff4444 });
                    const bodyMesh = new THREE.Mesh(body, bodyMaterial);
                    
                    const head = new THREE.SphereGeometry(0.3, 16, 16);
                    const headMaterial = new THREE.MeshPhongMaterial({ color: 0xffcccc });
                    const headMesh = new THREE.Mesh(head, headMaterial);
                    headMesh.position.y = 0.65;
                    
                    object = new THREE.Group();
                    object.add(bodyMesh);
                    object.add(headMesh);
                    object.userData.type = 'player';
                    object.userData.isPlayer = true;
                    break;
                    
                case 'light':
                    const light = new THREE.PointLight(0xffffff, 1, 10);
                    
                    // ì¡°ëª…ì„ ì‹œê°í™” í•˜ê¸° ìœ„í•œ êµ¬ì²´
                    const lightSphere = new THREE.SphereGeometry(0.1, 16, 16);
                    const lightMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
                    const lightMesh = new THREE.Mesh(lightSphere, lightMaterial);
                    
                    object = new THREE.Group();
                    object.add(light);
                    object.add(lightMesh);
                    object.userData.type = 'light';
                    break;
                    
                default:
                    return;
            }
            
            // ìƒì„±ëœ ê°ì²´ë¥¼ ì”¬ì— ì¶”ê°€
            scene.add(object);
            gameObjects.push(object);
            
            // ê°ì²´ ì„ íƒ
            selectObject(object);
            
            // ì†ì„± íŒ¨ë„ ì—…ë°ì´íŠ¸
            updatePropertyPanel();
        };
        
        // ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        function onCanvasClick(event) {
            if (selectedTool !== 'select') return;
            
            const canvas = document.getElementById('gameCanvas');
            const rect = canvas.getBoundingClientRect();
            const x = ((event.clientX - rect.left) / canvas.width) * 2 - 1;
            const y = -((event.clientY - rect.top) / canvas.height) * 2 + 1;
            
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera({ x, y }, camera);
            
            const intersects = raycaster.intersectObjects(scene.children, true);
            
            if (intersects.length > 0) {
                // ê·¸ë¦¬ë“œë‚˜ ì¶• ë¬´ì‹œ
                if (intersects[0].object.type === 'GridHelper' || 
                    intersects[0].object.type === 'AxesHelper') {
                    if (intersects.length > 1) {
                        selectObjectFromIntersect(intersects[1]);
                    } else {
                        deselectObject();
                    }
                } else {
                    selectObjectFromIntersect(intersects[0]);
                }
            } else {
                deselectObject();
            }
        }
        
        // ê´‘ì„  ì¶©ëŒ ê°ì²´ë¡œë¶€í„° ì„ íƒ
        function selectObjectFromIntersect(intersect) {
            // ë¶€ëª¨ ê°ì²´ ì°¾ê¸° (ê·¸ë£¹ì˜ ê²½ìš°)
            let objectToSelect = intersect.object;
            while (objectToSelect.parent && objectToSelect.parent !== scene) {
                objectToSelect = objectToSelect.parent;
            }
            
            selectObject(objectToSelect);
        }
        
        // ê°ì²´ ì„ íƒ
        function selectObject(object) {
            deselectObject();
            
            selectedObject = object;
            
            // ë³€í˜• ì»¨íŠ¸ë¡¤ ì—°ê²°
            if (transformControls) {
                transformControls.attach(object);
                
                if (selectedTool === 'move') {
                    transformControls.setMode('translate');
                } else if (selectedTool === 'rotate') {
                    transformControls.setMode('rotate');
                } else if (selectedTool === 'scale') {
                    transformControls.setMode('scale');
                }
            }
            
            // ì†ì„± íŒ¨ë„ ì—…ë°ì´íŠ¸
            updatePropertyPanel();
        }
        
        // ê°ì²´ ì„ íƒ í•´ì œ
        function deselectObject() {
            selectedObject = null;
            
            if (transformControls) {
                transformControls.detach();
            }
            
            // ì†ì„± íŒ¨ë„ ìˆ¨ê¸°ê¸°
            document.getElementById('property-panel').style.display = 'none';
        }
        
        // ì†ì„± íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updatePropertyPanel() {
            const panel = document.getElementById('property-panel');
            
            if (!selectedObject) {
                panel.style.display = 'none';
                return;
            }
            
            panel.style.display = 'block';
            
            // ê¸°ë³¸ ì†ì„± ì—…ë°ì´íŠ¸
            document.getElementById('objectName').value = selectedObject.name || '';
            
            // ìœ„ì¹˜ ê°’ ì—…ë°ì´íŠ¸
            document.getElementById('posX').value = selectedObject.position.x;
            document.getElementById('posY').value = selectedObject.position.y;
            document.getElementById('posZ').value = selectedObject.position.z;
            
            // íšŒì „ ê°’ ì—…ë°ì´íŠ¸ (ë¼ë””ì•ˆ -> ë„)
            document.getElementById('rotX').value = THREE.MathUtils.radToDeg(selectedObject.rotation.x);
            document.getElementById('rotY').value = THREE.MathUtils.radToDeg(selectedObject.rotation.y);
            document.getElementById('rotZ').value = THREE.MathUtils.radToDeg(selectedObject.rotation.z);
            
            // í¬ê¸° ê°’ ì—…ë°ì´íŠ¸
            document.getElementById('scaleX').value = selectedObject.scale.x;
            document.getElementById('scaleY').value = selectedObject.scale.y;
            document.getElementById('scaleZ').value = selectedObject.scale.z;
            
            // ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            if (selectedObject.material && selectedObject.material.color) {
                const hexColor = '#' + selectedObject.material.color.getHexString();
                document.getElementById('objectColor').value = hexColor;
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            setupPropertyListeners();
        }
        
        // ì†ì„± ê°’ ë³€ê²½ ì´ë²¤íŠ¸ ë“±ë¡
        function setupPropertyListeners() {
            // ì´ë¦„ ë³€ê²½
            document.getElementById('objectName').addEventListener('change', function(e) {
                if (selectedObject) {
                    selectedObject.name = e.target.value;
                }
            });
            
            // ìœ„ì¹˜ ë³€ê²½
            document.getElementById('posX').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.position.x = parseFloat(e.target.value);
                }
            });
            
            document.getElementById('posY').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.position.y = parseFloat(e.target.value);
                }
            });
            
            document.getElementById('posZ').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.position.z = parseFloat(e.target.value);
                }
            });
            
            // íšŒì „ ë³€ê²½
            document.getElementById('rotX').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.rotation.x = THREE.MathUtils.degToRad(parseFloat(e.target.value));
                }
            });
            
            document.getElementById('rotY').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.rotation.y = THREE.MathUtils.degToRad(parseFloat(e.target.value));
                }
            });
            
            document.getElementById('rotZ').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.rotation.z = THREE.MathUtils.degToRad(parseFloat(e.target.value));
                }
            });
            
            // í¬ê¸° ë³€ê²½
            document.getElementById('scaleX').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.scale.x = parseFloat(e.target.value);
                }
            });
            
            document.getElementById('scaleY').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.scale.y = parseFloat(e.target.value);
                }
            });
            
            document.getElementById('scaleZ').addEventListener('input', function(e) {
                if (selectedObject) {
                    selectedObject.scale.z = parseFloat(e.target.value);
                }
            });
            
            // ìƒ‰ìƒ ë³€ê²½
            document.getElementById('objectColor').addEventListener('input', function(e) {
                if (selectedObject) {
                    if (selectedObject.material && selectedObject.material.color) {
                        selectedObject.material.color.set(e.target.value);
                    } else if (selectedObject.children) {
                        // ê·¸ë£¹ ê°ì²´ì¸ ê²½ìš° ëª¨ë“  ìì‹ì˜ ìƒ‰ìƒ ë³€ê²½
                        selectedObject.children.forEach(child => {
                            if (child.material && child.material.color) {
                                child.material.color.set(e.target.value);
                            }
                        });
                    }
                }
            });
            
            // í–‰ë™ íŒ¨í„´ ë³€ê²½
            document.getElementById('behaviorType').addEventListener('change', function(e) {
                if (selectedObject) {
                    selectedObject.userData.behavior = e.target.value;
                }
            });
        }
        
        // í™˜ê²½ í† ê¸€ í•¨ìˆ˜ë“¤
        window.toggleSkybox = function() {
            skyboxEnabled = !skyboxEnabled;
            
            if (skyboxEnabled) {
                // ìŠ¤ì¹´ì´ë°•ìŠ¤ ì¶”ê°€
                const skyboxLoader = new THREE.CubeTextureLoader();
                const skyboxTexture = skyboxLoader.load([
                    'skybox/px.jpg', 'skybox/nx.jpg',
                    'skybox/py.jpg', 'skybox/ny.jpg',
                    'skybox/pz.jpg', 'skybox/nz.jpg'
                ]);
                scene.background = skyboxTexture;
            } else {
                // ìŠ¤ì¹´ì´ë°•ìŠ¤ ì œê±°
                scene.background = new THREE.Color(0x222222);
            }
        };
        
        window.togglePhysics = function() {
            physicsEnabled = !physicsEnabled;
            alert(physicsEnabled ? "ë¬¼ë¦¬ ì—”ì§„ í™œì„±í™”ë¨" : "ë¬¼ë¦¬ ì—”ì§„ ë¹„í™œì„±í™”ë¨");
        };
        
        window.toggleCollision = function() {
            collisionEnabled = !collisionEnabled;
            alert(collisionEnabled ? "ì¶©ëŒ ê°ì§€ í™œì„±í™”ë¨" : "ì¶©ëŒ ê°ì§€ ë¹„í™œì„±í™”ë¨");
        };
        
        // ê²Œì„ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        window.previewGame = function() {
            // ê²Œì„ ë¯¸ë¦¬ë³´ê¸° ë¡œì§
            alert("ê²Œì„ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ");
        };
        
        window.clearScene = function() {
            // ì”¬ ì´ˆê¸°í™”
            while (gameObjects.length > 0) {
                const object = gameObjects.pop();
                scene.remove(object);
            }
            
            deselectObject();
        };
        
        window.saveGame = function() {
            // ê²Œì„ ê°ì²´ ë°ì´í„° ìˆ˜ì§‘
            const gameData = gameObjects.map(obj => {
                const data = {
                    type: obj.userData.type,
                    position: {
                        x: obj.position.x,
                        y: obj.position.y,
                        z: obj.position.z
                    },
                    rotation: {
                        x: obj.rotation.x,
                        y: obj.rotation.y,
                        z: obj.rotation.z
                    },
                    scale: {
                        x: obj.scale.x,
                        y: obj.scale.y,
                        z: obj.scale.z
                    },
                    name: obj.name || '',
                    userData: obj.userData
                };
                
                // ì¬ì§ˆ ì •ë³´ ì €ì¥
                if (obj.material && obj.material.color) {
                    data.color = '#' + obj.material.color.getHexString();
                }
                
                return data;
            });
            
            // ê²Œì„ ì„¤ì • ì •ë³´ ì¶”ê°€
            const gameConfig = {
                skyboxEnabled,
                physicsEnabled,
                collisionEnabled
            };
            
            // ìµœì¢… ì €ì¥ ë°ì´í„°
            const saveData = {
                objects: gameData,
                config: gameConfig
            };
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('savedGame3D', JSON.stringify(saveData));
            alert("3D ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        };
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì”¬ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initScene);
    </script>
</body>
</html>